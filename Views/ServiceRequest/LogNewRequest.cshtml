@model SRM.Models.EmployeeProfile
@{
    ViewBag.Title = "Log New Request";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="setup-container">
    <div class="section-header">
        <h2>Log New Request</h2>
    </div>

    @* Search Section *@
    <div class="action-row" style="margin-bottom:20px; padding:15px; background:#fdfdfd; border:1px solid #eee; border-radius:4px;">
        @using (Html.BeginForm("LogNewRequest", "NewRequest", FormMethod.Get, new { @class = "form-inline" }))
        {
            <label class="control-label" style="margin-right:10px;"><strong>Reported Employee ID:</strong></label>
            <input type="text" name="searchPno" value="@Model.Pno" class="form-control" style="width:200px; display:inline-block;" placeholder="Enter P-No..." required />
            <button type="submit" class="setup-btn-green">🔍 Search & Load</button>
        }
    </div>

    @using (Html.BeginForm("SaveRequest", "NewRequest", FormMethod.Post, new { id = "logRequestForm" }))
    {
        @Html.AntiForgeryToken()

        <div class="form-section-header">User Information</div>
        <div class="grid-container">
            <div class="grid-label">Reported P-no</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.Pno, new { @readonly = "readonly", @style = "background:#eee;" })
            </div>
            <div class="grid-label">Employee Name</div> <div class="grid-input">
                @Html.TextBoxFor(m => m.emp_name, new { @readonly = "readonly", @style = "background:#eee;" })
            </div>
            <div class="grid-label">Designation</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.Emp_designation, new { @readonly = "readonly", @style = "background:#eee;" })
            </div>
            <div class="grid-label">Department</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.ATTENDANCE_DEPT_CODE, new { @readonly = "readonly", @style = "background:#eee;" })
            </div>
            <div class="grid-label">Email</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.Email)
            </div>
            <div class="grid-label">Mobile No</div>
            <div class="grid-input" style="display:flex; gap:5px;">
                @Html.TextBoxFor(m => m.mobileno, new { @style = "width:68%;" })
                @Html.TextBoxFor(m => m.MobileOperator, new { @readonly = "readonly", @style = "width:28%; background:#eee;" })
            </div>
            <div class="grid-label">Phone-Ext</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.Office_ext)
            </div>
            <div class="grid-label">Room No *</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.roomno, new { @required = "required" })
            </div>
            <div class="grid-label">IP-Address</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.ip_address)
            </div>
            <div class="grid-label">Location *</div>
            <div class="grid-input">
                @Html.TextBoxFor(m => m.Location, new { @required = "required" })
            </div>
        </div>

        <div class="form-section-header">Service Request Details</div>
        <div class="details-box">
            <div class="details-row">
                <div class="details-label">Priority</div>
                <div class="details-content">
                    <div class="radio-group" style="display:flex; gap:15px;">
                        <label style="color:#f5365c; font-weight:bold;"><input type="radio" name="Priority" value="Critical" /> Critical</label>
                        <label><input type="radio" name="Priority" value="Urgent" /> Urgent</label>
                        <label><input type="radio" name="Priority" value="Important" /> Important</label>
                        <label><input type="radio" name="Priority" value="Normal" checked /> Normal</label>
                    </div>
                </div>
            </div>

            <div class="details-row">
                <div class="details-label">* Problem Area</div>
                <div class="details-content">
                    <label style="margin-right:10px;"><input type="checkbox" name="Area" value="Hardware" /> Hardware</label>
                    <label style="margin-right:10px;"><input type="checkbox" name="Area" value="Software" /> Software</label>
                    <label style="margin-right:10px;"><input type="checkbox" name="Area" value="Internet" /> Internet</label>
                    <label><input type="checkbox" name="Area" value="Network" /> Network</label>
                </div>
            </div>

            <div class="details-row">
                <div class="details-label">* Request Summary</div>
                <div class="details-content">
                    <input type="text" name="Summary" class="form-control" style="width:100%;" required />
                </div>
            </div>

            <div class="details-row">
                <div class="details-label">Request Details</div>
                <div class="details-content">
                    <textarea name="Details" class="form-control" style="width:100%; height:80px;"></textarea>
                </div>
            </div>
        </div>

        <div class="action-footer" style="margin-top: 20px; text-align: right; padding: 20px; border-top: 1px solid #eee;">
            <button type="submit" class="setup-btn-green" style="min-width:200px;">💾 Save Request</button>
        </div>
    }
</div>
@section scripts {
    <script>
        $(function () {
            // 1. VALIDATION BEFORE SAVE (Local to this page)
            $('#logRequestForm').on('submit', function (e) {
                // If no checkbox is checked
                if ($('input[name="Area"]:checked').length === 0) {
                    e.preventDefault();

                    // We call the function that is now globally available
                    // Use 'showGlobalToast' if that's what you named it in _Layout
                    showGlobalToast("Please select at least one Problem Area.", "error");
                }
            });
        });
    </script>
}
